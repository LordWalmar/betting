// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    var $catalogList, $companyReadMore, $feedbackParticipate, $homeSlider, $readMore, $tagCategory, $thnx_registr, body, catalogMobWidth, newYearBlock, replaceCalendar, showMenuIcon, submitButton_styled;
    wbtFallbackerRun();
    newYearBlock = $('.newyear-fancybox');
    if (newYearBlock.length) {
      $(document).ready(function() {
        return newYearBlock.fancybox({
          wrapCSS: "newyear-fancybox-wrap"
        }).trigger("click");
      });
    }
    $thnx_registr = $(".form-section_thnx");
    $('body').on("click", ".form-section_thnx", function(e) {
      if (!$(e.target).closest('.form_logo').length && !$(e.target).closest('.form_wrapper').length) {
        return window.location = "/";
      }
    });
    $homeSlider = $(".home-section__promo");
    if ($homeSlider.length) {
      $(".l-header").css("box-shadow", "none").css("border-bottom", "none");
      $(".home-promo_slider").wbtSlider({
        items: [
          {
            src: "static/img/conference_1.jpg",
            header: "",
            title: "",
            text: "",
            conclusion: "",
            href: "about_service.php#0"
          }, {
            src: "static/img/ph_st1.jpg",
            header: "Почему СТРОЙТОРГИ?",
            title: "Мы первая специализированная",
            text: "электронная торговая площадка для компаний строительной индустрии на всей территории России.",
            conclusion: "/ Поэтому СТРОЙТОРГИ /",
            href: "about_service.php#0"
          }, {
            src: "static/img/ph_st2.jpg",
            header: "Интеграция с 1С",
            title: "Сумма сделки по итогам торгов совпадает",
            text: "с суммой, прошедшей через вашу учетную систему 1С.",
            conclusion: "/ Поэтому ДОВЕРИЕ /",
            href: "about_service.php#1"
          }, {
            src: "static/img/ph_st3.jpg",
            header: "Гарантия сделки",
            title: "Торги прошли —  сделка будет",
            text: "Протокол итогов торгов имеет силу контракта.",
            conclusion: "/ Поэтому ГАРАНТИРУЕМ /",
            href: "about_service.php#2"
          }, {
            src: "static/img/ph_st4.jpg",
            header: "Справедливое ценообразование",
            title: "Платит только тот, кто победил в торгах",
            text: "Абонентской платы, депозитов и других комиссий нет!",
            conclusion: "/ Поэтому ПРОЗРАЧНОСТЬ /",
            href: "about_service.php#3"
          }, {
            src: "static/img/ph_st5.jpg",
            header: "Аналитика",
            title: "Мы первые, кто дает статистику реальной стоимости",
            text: "товаров и услуг в строительной отрасли.",
            conclusion: "/ Поэтому ЭКСПЕРТНОСТЬ /",
            href: "about_service.php#4"
          }, {
            src: "static/img/photo_slider.png",
            header: "Цивилизованный рынок",
            title: "Сделка – это не всё!",
            text: "Узнайте больше…",
            conclusion: "/ Поэтому БУДУЩЕЕ /",
            href: "about_service.php#5"
          }
        ]
      });
      $(window).on("resize", function() {
        var leftTextBlock, marginSlider;
        leftTextBlock = $('.home-promo_info').offset().left;
        marginSlider = leftTextBlock > 364 ? 0 : 364 - leftTextBlock;
        $('li.wbt-slider').css('background-position-x', -marginSlider + 'px');
        $('li.wbt-slider').eq(0).css('background-position', 'center').css('background-size', 'contain');
        return $('li.wbt-slider').eq(7).css('background-position', 'center').css('background-size', 'contain');
      });
      $('.home-promo_text').on("click", function(e) {
        if (!$(e.target).closest('.wbt-slider_dots').length) {
          return window.location = $(this).data('href');
        }
      });
      $('.wbt-slider_dots li').first().css('display', 'none');
      $('.home-auction-search_title').on('click', function(ev) {
        var filterSection;
        ev.preventDefault();
        filterSection = $(this).closest('.home-auction-search');
        if (filterSection.hasClass('home-auction-search__active')) {
          filterSection.removeClass('home-auction-search__active');
          return filterSection.find('.home-auction-search_filter').css('overflow', 'hidden');
        } else {
          filterSection.addClass('home-auction-search__active');
          return setTimeout(function() {
            return filterSection.find('.home-auction-search_filter').css('overflow', 'visible');
          }, 300);
        }
      });
      $('.home-reviews_swith').on('click', function(ev) {
        var content, textValue;
        ev.preventDefault();
        content = $('.home-reviews_content');
        textValue = content.hasClass('home-reviews_content__active') ? "Читать дальше" : "Скрыть";
        $('.home-reviews_swith').text(textValue);
        return content.toggleClass('home-reviews_content__active');
      });

      /*
      $('.input-select[name="filter_category"]').on 'change', ()->
        pointValue = $(this).find('option:selected').val()
        select = $('.filter-category__additional')
        console.log pointValue
        console.log +pointValue == 0
        if +pointValue == 0
          select.addClass('filter-category__home')
          select.val('Yeap!')
        else
          select.removeClass('filter-category__home')
       */
    }
    submitButton_styled = function($form, disable) {
      var $submit_btn, color;
      $submit_btn = $form.find('button[type=submit], input[type=submit]');
      color = $submit_btn.attr('data-color') ? $submit_btn.attr('data-color') : ($submit_btn.hasClass('btn-submit__red') ? 'red' : 'grey');
      $submit_btn.attr('data-color', color);
      $submit_btn.toggleClass("btn-submit__" + color, !disable);
      $submit_btn.toggleClass("btn-loading", disable);
      $submit_btn.toggleClass("btn-loading__" + color, disable);
      return $submit_btn.prop('disabled', disable);
    };
    $('.filter-calendar-cell_date').datepick({
      dateFormat: 'dd.mm.yyyy',
      showAnim: '',
      minDate: new Date(2012, 8 - 1, 1),
      maxDate: +30,
      showTrigger: '#calImg'
    });
    $(window).on("resize", function() {
      $('.filter-calendar-cell_date').datepick('hide');
      return $('.filter-calendar-cell_date').blur();
    });
    $(".input-checkbox, .input-radio, .input-range, .input-select").wbtFormStyler();
    $tagCategory = $(".category");
    if ($tagCategory.length) {
      $(".category").on("click", function(e) {
        return e.stopPropagation();
      });
    }
    $("#table_auction").on('click', '.table-auction_row[data-href]', function() {
      return window.location = $(this).data('href');
    });
    $feedbackParticipate = $(".feedback-participate");
    if ($feedbackParticipate.length) {
      $('.feedback-participate_item').eq(0).addClass('feedback-participate_item__active');
      $('.feedback-participate_item').hover(function() {
        $('.feedback-participate_item').removeClass('feedback-participate_item__active');
        return $(this).addClass('feedback-participate_item__active');
      });
    }
    $('body').on("click", ".signin-menu_item", function(e) {
      $(this).addClass('signin-menu_item__active').siblings().removeClass('signin-menu_item__active');
      return $('.signin-tab_' + $(this).data('name')).addClass('signin-tab__active').siblings().removeClass('signin-tab__active');
    });
    $('body').on("click", ".signin_forgotLogin", function(e) {
      e.preventDefault();
      $('.signin-menu_item').removeClass('signin-menu_item__active');
      return $('.signin-tab_nopassword').addClass('signin-tab__active').siblings().removeClass('signin-tab__active');
    });
    showMenuIcon = function() {
      var activeBlock;
      activeBlock = $('.header-company');
      if ($('.header-menu-icon').css('display') === 'inline-block') {
        return activeBlock.addClass('header-company__mobile');
      } else {
        return activeBlock.removeClass('header-company__mobile');
      }
    };
    $(window).on("resize", function() {
      return showMenuIcon();
    }).trigger("resize");
    $(".header-menu-icon").on("click", function(e) {
      e.preventDefault();
      $(this).closest(".header-company").toggleClass("header-company__active");
    });
    $catalogList = $(".catalog-fields");
    if ($catalogList.length) {
      $catalogList.on("click", ".catalog-fields_title", function() {
        return $(this).closest(".catalog-fields_item").toggleClass("catalog-fields_item__active").children(".catalog-fields-list").slideToggle(200);
      });
      $catalogList.on("click", ".catalog-fields-list_status", function() {
        return $(this).closest(".catalog-fields-list_item").toggleClass("catalog-fields-list_item__active").children(".catalog-fields-list").slideToggle(200);
      });
      body = $("body");
      catalogMobWidth = 857;
      $(window).on("resize", function() {
        var bodyWidth;
        bodyWidth = body.width();
        if (bodyWidth < catalogMobWidth) {
          return $('.catalog_item__data').css({
            marginTop: 20 + "px"
          });
        }
      });
      $(window).on("scroll", function() {
        var bodyWidth, catLastItem, scrollAnchor;
        bodyWidth = body.width();
        if (bodyWidth > catalogMobWidth) {
          scrollAnchor = $('.catalog-anchor').offset().top - 325;
          catLastItem = $('.catalog_item__fields').height();
          if (scrollAnchor < 0) {
            scrollAnchor = 0;
          }
          if (scrollAnchor > catLastItem) {
            scrollAnchor = catLastItem;
          }
          return $('.catalog_item__data').css({
            marginTop: scrollAnchor + 'px'
          });
        }
      });
      $catalogList.on("click", ".catalog-fields-list_name", function() {
        var bodyWidth, currentMargin, dataPosition, scrollTopMargin;
        $(".catalog-fields-list_name").removeClass('catalog-fields-list_name__active');
        $(".catalog-fields-list_status").removeClass('catalog-fields-list_status__active');
        $(this).addClass('catalog-fields-list_name__active').prevAll('.catalog-fields-list_status:first').addClass('catalog-fields-list_status__active');
        bodyWidth = body.width();
        if (bodyWidth > catalogMobWidth) {
          currentMargin = $(this).offset().top - 325;
          scrollTopMargin = $(this).offset().top - 20;
          $('.catalog_item__data').css({
            marginTop: currentMargin + 'px'
          });
          return $('body, html').animate({
            scrollTop: scrollTopMargin + 'px'
          });
        } else {
          console.log("mob catalog");
          $('.catalog_item__data').css({
            marginTop: 20 + "px"
          });
          dataPosition = $('.catalog_item__data').offset().top - 20;
          return body.animate({
            scrollTop: dataPosition + 'px'
          });
        }
      });
    }
    $("body").on("click", ".switch_element", function() {
      return $(this).closest(".switch_item").addClass('switch_item__active').siblings().removeClass('switch_item__active');
    });
    $("body").on("click", ".signin-password_visible", function(e) {
      var $newPassword, $oldPassword;
      e.preventDefault();
      if ($(this).hasClass('signin-password_visible__active')) {
        $oldPassword = $(this).closest('.signin-password').find('input');
        $newPassword = $("<input class='input-text' type='password' />").val($oldPassword.val()).attr('name', $oldPassword.attr('name')).prependTo($oldPassword.parent());
        $oldPassword.remove();
      } else {
        $oldPassword = $(this).closest('.signin-password').find('input');
        $newPassword = $("<input class='input-text' type='text' />").val($oldPassword.val()).attr('name', $oldPassword.attr('name')).prependTo($oldPassword.parent());
        $oldPassword.remove();
      }
      return $(this).toggleClass('signin-password_visible__active');
    });
    $('body').on("submit", "form", function(e) {
      var $submit_btn;
      if ($(this).attr('data-process') === '1') {
        $(this).attr('data-process', '0');
        return false;
      }
      $submit_btn = $(this).find('button[type=submit], input[type=submit]');
      if ($submit_btn.hasClass('btn-loading')) {
        return false;
      }
      if ($(this).hasClass('form_invalid')) {
        return false;
      }
      if (!($submit_btn.hasClass('filter-search_button'))) {
        return submitButton_styled($(this), true);
      }
    });
    $(".footer-siteinfo_law").on("click", function(e) {
      e.preventDefault();
      $(this).closest(".footer-siteinfo_item").toggleClass("footer-siteinfo_item__active");
    });
    $readMore = $(".reviews_readmore");
    if ($readMore.length) {
      $readMore.fancybox({
        wrapCSS: "rewiews_license",
        margin: 0,
        padding: 0,
        closeBtn: true,
        autoSize: false,
        fitToView: false,
        afterLoad: function(current) {
          $(window).on('resize', function() {
            var currentHeightImg, currentWidth, k, naturalHeightImg, naturalWidthImg, widthNow;
            naturalWidthImg = current.width;
            naturalHeightImg = current.height;
            widthNow = Number($(window).width());
            currentWidth = (widthNow > 630 ? 630 : widthNow);
            k = currentWidth / naturalWidthImg;
            currentHeightImg = k * naturalHeightImg;
            return $('.rewiews_license .fancybox-inner').css('max-height', currentHeightImg);
          });
          $(window).resize();
        }
      });
    }
    $companyReadMore = $(".company-read_link");
    if ($companyReadMore.length) {
      $companyReadMore.fancybox({
        wrapCSS: "reviews-fancybox_wrapper",
        margin: 0,
        padding: 0,
        width: 90 + '%',
        height: 100 + '%',
        closeBtn: false,
        autoSize: false,
        fitToView: false
      });
    }
    $('body').on("click", ".window-modal_close", function(e) {
      e.preventDefault();
      return $.fancybox.close(true);
    });
    $('body').on("click", ".form_background", function(e) {
      if ($(e.target).hasClass('form-section')) {
        return $.fancybox.close(true);
      }
    });
    (replaceCalendar = function() {
      if ($(this).width() < 854) {
        return $('.filter-companies_calendar').insertAfter($('.filter-search'));
      } else {
        return $('.filter-companies_calendar').insertBefore($('.filter-search'));
      }
    })();
    return $(window).on("resize", function() {
      return replaceCalendar();
    });
  });

}).call(this);
