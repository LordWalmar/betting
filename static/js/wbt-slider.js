// Generated by CoffeeScript 1.7.1
(function() {
  (function($) {
    var wbtSlider;
    wbtSlider = function($el, params) {
      var i, interval, self, temp, tt, _i, _j, _ref, _ref1;
      this.$items = params.items;
      this.defaults = {
        "nav": false,
        "dots": true,
        "ranges": false,
        "ordered": false,
        "share": false,
        "showBy": 1,
        "changeBy": 1,
        "beforeChange": function() {},
        "afterChange": function() {}
      };
      this.cfg = $.extend({}, this.defaults, params);
      this.items = params.items;
      this.sliderClass = $el.attr("class");
      this.$slider = $el;
      this.$slider.addClass("wbt-slider_list");
      this.$wrap = this.$slider.wrap('<div class="wbt-slider_wrap"></div>').parent();
      for (i = _i = 0, _ref = this.items.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        $('<li class="wbt-slider wbt-slider_' + i + '"></li>').appendTo(this.$slider);
        $(".wbt-slider_" + i).css("background-image", "url(\"" + this.items[i]["src"] + "\")");
      }
      $(".wbt-slider").eq(0).clone().appendTo(".wbt-slider_list");
      this.changeText(0);
      this.sliderLength = params.items.length;
      if (this.cfg.nav) {
        this.$nav = $('<div class="wbt-slider_nav"><a href="#" class="wbt-slider_nav__prev" data-dir="prev"></a><a href="#" class="wbt-slider_nav__next" data-dir="next"></a></div>').appendTo(this.$wrap);
      }
      if (this.cfg.share) {
        this.$share = $('<div class="wbt-slider_icons"><a href="#" class="wbt-slider_icons__pintrest" data-media="pin"></a><a href="#" class="wbt-slider_icons__tumblr" data-media="tbl"></a></div>').appendTo(this.$wrap);
        this.$share.hide();
      }
      if (this.cfg.ranges) {
        this.cfg.$ranges = $('<div class="wbt-slider_ranges"><span class="wbt-slider_ranges__prev"></span><span>/<span><span class="wbt-slider_ranges__next"></span></div>').appendTo(this.$wrap);
        this.cfg.rangesPrev = this.cfg.$ranges.children().eq(0);
        this.cfg.rangesNext = this.cfg.$ranges.children().eq(2);
      }
      if (this.cfg.ordered) {
        this.cfg.$ordered = $('<div class="wbt-slider_ordered"><span class="wbt-slider_ordered__current"></span><span>/</span><span class="wbt-slider_ordered__length"></span></div>').appendTo(this.$wrap);
        this.cfg.$orderedCurrent = this.cfg.$ordered.children().eq(0);
        this.cfg.$orderedLength = this.cfg.$ordered.children().eq(2);
      }
      if (this.cfg.dots) {
        temp = "";
        for (i = _j = 0, _ref1 = this.sliderLength; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
          tt = this.$slider.children().eq(i).data("title");
          temp += '<li><div class="wbt-slidet_number">0' + i + '</div><div class="wbt-slider_background-line"><a href="#">' + (tt ? tt : '') + '</a></div></li>';
        }
        this.$dots = $('<ul class="wbt-slider_dots">' + temp + '</ul>').appendTo($('.home-promo_text'));
      }
      this.itemsWidth = 0;
      this.itemsVisible = 0;
      this.currentIndex = 0;
      this.loadedLine();
      this.events.click.call(this);
      self = this;
      interval = 0;
      setTimeout(function() {
        self.initSlider();
      }, 60);
      $(window).on("resize", function() {
        clearInterval(interval);
        interval = setTimeout(function() {
          self.initSlider();
        }, 100);
      });
    };
    wbtSlider.prototype.changeText = function(item) {
      var blockFooter, blockResponsibility, blockText, blockTitle, blockWarranty, self;
      if (item === 0) {
        $('.home-promo_info').addClass('home-promo_info__banner');
      } else {
        $('.home-promo_info').removeClass('home-promo_info__banner');
      }
      blockWarranty = $('.home-promo_warranty');
      blockTitle = $('.home-promo_title');
      blockResponsibility = $('.home-promo_responsibility');
      blockFooter = $('.home-promo_footer');
      blockText = $('.home-promo_text');
      blockTitle.fadeOut(200);
      blockResponsibility.fadeOut(200);
      blockWarranty.fadeOut(200);
      blockFooter.fadeOut(200);
      self = this;
      setTimeout((function() {
        blockWarranty.text(self.items[item]["header"]);
        blockTitle.text(self.items[item]["title"]);
        blockResponsibility.text(self.items[item]["text"]);
        blockFooter.text(self.items[item]["conclusion"]);
        blockText.data('href', self.items[item]["href"]);
      }), 200);
      console.log('href', self.items[item]["href"]);
      blockWarranty.fadeIn(200);
      blockTitle.fadeIn(200);
      blockResponsibility.fadeIn(200);
      return blockFooter.fadeIn(200);
    };
    wbtSlider.prototype.loadedLine = function() {
      var i;
      if (this.currentIndex === 0) {
        $(".wbt-slider_dots li a").map(function() {
          $(this).css("width", "0px");
          $(this).closest('.wbt-slider_background-line').css("background", "#BB0D36");
          console.log($(this).width());
        });
      }
      $(".wbt-slider_dots li a").map(function() {
        $(this).removeClass("wbt-slider_dots__active");
      });
      $(".wbt-slider_dots li a").eq(this.currentIndex).addClass("wbt-slider_dots__active");
      i = 0;
      while (i <= this.currentIndex) {
        if (i !== this.currentIndex) {
          $(".wbt-slider_dots li a").eq(i).closest('.wbt-slider_background-line').css("background", "none");
        }
        $(".wbt-slider_dots li a").eq(i).css("width", "100%");
        i++;
      }
    };
    wbtSlider.prototype.changeIndex = function(direction) {
      var maxIndex, newIndex;
      newIndex = this.currentIndex;
      maxIndex = this.cfg.changeBy === 1 ? this.sliderLength - this.itemsVisible : this.sliderLength - this.sliderLength % this.itemsVisible;
      if (direction === parseInt(direction, 10)) {
        newIndex = direction;
      } else {
        newIndex += direction === "next" ? (this.cfg.changeBy === 1 ? 1 : this.itemsVisible) : (direction === "prev" ? -(this.cfg.changeBy === 1 ? 1 : this.itemsVisible) : 0);
      }
      if (newIndex < 0) {
        newIndex = maxIndex;
      }
      this.cfg.beforeChange();
      this.currentIndex = newIndex;
      this.$slider.animate({
        left: -(this.itemsWidth * newIndex)
      }, 300);
      if (newIndex >= this.sliderLength) {
        setTimeout((function() {
          $(".wbt-slider_list").css({
            left: "0px"
          });
        }), 500);
        this.currentIndex = 0;
      }
      if (newIndex >= maxIndex) {
        newIndex = maxIndex;
      }
      this.changeText(this.currentIndex);
      if (this.clickCount !== 0) {
        this.loadedLine();
      }
      return this.cfg.afterChange();
    };
    wbtSlider.prototype.calculateRanges = function(index) {
      var lower, upper;
      if (index < 0 || index >= this.sliderLength) {
        return "";
      }
      lower = index + 1;
      upper = (index + this.itemsVisible) > this.sliderLength ? this.sliderLength : index + this.itemsVisible;
      if (lower === upper) {
        return lower;
      }
      return lower + "-" + upper;
    };
    wbtSlider.prototype.updateRanges = function() {
      var changeBy;
      if (this.cfg.ranges) {
        changeBy = this.cfg.changeBy === 1 ? 1 : this.itemsVisible;
        this.cfg.$rangesPrev.text(this.calculateRanges(this.currentIndex - changeBy));
        this.cfg.$rangesNext.text(this.calculateRanges(this.currentIndex + changeBy));
      }
    };
    wbtSlider.prototype.updateOrdered = function() {
      if (this.cfg.ordered) {
        this.cfg.$orderedCurrent.text(this.currentIndex + 1);
        this.cfg.$orderedLength.text(this.sliderLength);
      }
    };
    wbtSlider.prototype.updatePositions = function() {
      window.sliderHeight = $('.' + this.sliderClass + ' li:nth-child(' + (this.currentIndex + 1) + ')  img').height();
      this.$wrap.find('.wbt-slider_nav__prev, .wbt-slider_nav__next').css({
        'min-height': sliderHeight,
        'top': '1px'
      });
      this.$wrap.find('.wbt-slider_icons').css({
        'top': sliderHeight
      });
      this.$wrap.find('.wbt-slider_ordered').css({
        'top': sliderHeight
      });
    };
    wbtSlider.prototype.initSlider = function() {
      this.itemsWidth = Math.floor(this.$wrap.width() / this.cfg.showBy);
      this.$slider.children().css({
        'width': this.itemsWidth
      });
      this.itemsVisible = Math.floor(this.$wrap.width() / this.itemsWidth);
      if (this.cfg.ranges) {
        this.updateRanges();
      }
      if (this.cfg.ordered) {
        this.updateOrdered();
      }
      if (this.cfg.nav) {
        if (this.sliderLength <= this.itemsVisible) {
          this.$nav.hide();
        } else {
          this.$nav.show();
          this.updatePositions();
        }
      }
    };
    wbtSlider.prototype.linkToSocial = function(mediaName) {
      var currentDescribe, currentImg, pinterestLink, slideUrl, slideUrlEncoded, socialDescriptionEncodedText, socialDescriptionText, socialMediaEncoded, tumblrLink;
      slideUrl = window.location;
      if (this.items[this.currentIndex]["href"] === "") {
        currentImg = $('.' + this.sliderClass + ' li:nth-child(' + (this.currentIndex + 1) + ') > span > img').attr("src");
      } else {
        currentImg = $('.' + this.sliderClass + ' li:nth-child(' + (this.currentIndex + 1) + ') > a > img').attr("src");
      }
      currentDescribe = $('.' + this.sliderClass + ' li:nth-child(' + (this.currentIndex + 1) + ') > div > p > strong').text();
      slideUrlEncoded = encodeURIComponent(slideUrl);
      socialMediaEncoded = encodeURIComponent(slideUrl + currentImg);
      socialDescriptionText = currentDescribe;
      socialDescriptionEncodedText = encodeURIComponent(socialDescriptionText);
      switch (mediaName) {
        case "pin":
          pinterestLink = 'http://www.pinterest.com/pin/create/button/?url=' + slideUrlEncoded + '&media=' + socialMediaEncoded + '&description=' + socialDescriptionText;
          window.open(pinterestLink);
          break;
        case "tbl":
          tumblrLink = 'http://www.tumblr.com/share/photo?source=' + socialMediaEncoded + '&caption=' + socialDescriptionEncodedText + '&clickthru=' + slideUrlEncoded;
          window.open(tumblrLink);
          break;
      }
    };
    wbtSlider.prototype.events = {
      click: function() {
        var scrollAccess, self, slideStart, slideStop, timeoutId, timerOff, timerOn;
        timeoutId = void 0;
        self = this;
        timerOn = function() {
          timeoutId = setInterval(function() {
            self.changeIndex("next");
          }, 9000);
        };
        timerOff = function() {
          clearInterval(timeoutId);
        };
        slideStart = function() {
          if (self.clickCount === 0) {
            timerOn();
            self.loadedLine();
            return self.clickCount = 1;
          }
        };
        timerOn();
        slideStop = function($this) {
          var currentButton, i;
          self.clickCount = 0;
          timerOff();
          $(".wbt-slider_dots li a").map(function(e) {
            $(this).removeClass("wbt-slider_dots__active");
            $(this).css("width", "0");
            $(this).closest('.wbt-slider_background-line').css("background", "#BB0D36");
          });
          currentButton = this.currentIndex;
          if ($this) {
            currentButton = $($this).index();
          }
          i = 0;
          while (i < currentButton) {
            if (i !== this.currentIndex) {
              $(".wbt-slider_dots li a").eq(i).closest('.wbt-slider_background-line').css("background", "none");
            }
            $(".wbt-slider_dots li a").eq(i).css("width", "100%");
            i++;
          }
          return self.changeIndex(currentButton);
        };
        scrollAccess = false;
        $(window).scroll(function() {
          var heightCurrent, heightSlider;
          heightCurrent = $(this).scrollTop();
          heightSlider = $('.home-section__auction').offset().top;
          if (heightCurrent >= heightSlider) {
            if (scrollAccess === false) {
              scrollAccess = true;
              return slideStop();
            }
          } else {
            if (scrollAccess) {
              scrollAccess = false;
              return slideStart();
            }
          }
        });
        if (this.cfg.nav) {
          this.$nav.on("click", "a", function(e) {
            e.preventDefault();
            self.changeIndex($(this).data("dir"));
            if (self.cfg.ranges) {
              self.updateRanges();
            }
            if (self.cfg.ordered) {
              self.updateOrdered();
            }
            self.updatePositions();
          });
        }
        if (this.cfg.dots) {
          this.$dots.on("click", "li", function(e) {
            e.preventDefault();
            slideStop(this);
            $('.home-section__promo').mouseleave(function() {
              return slideStart();
            });
            return $('body').on("click", function(e) {
              if ($(e.target).closest(".home-section__promo").length) {
                return;
              }
              return slideStart();
            });
          });
        }
        if (this.cfg.share) {
          this.$wrap.find('.wbt-slider_list li img, .wbt-slider_icons').mouseover(function() {
            self.$wrap.find('.wbt-slider_icons').show();
          }).mouseout(function() {
            self.$wrap.find('.wbt-slider_icons').hide();
          });
          $('.wbt-slider_icons a').click(function(e) {
            var mName;
            e.preventDefault();
            mName = $(this).data("media");
            self.linkToSocial(mName);
          });
        }
      }
    };
    $.fn.wbtSlider = function(params) {
      return new wbtSlider(this, params);
    };
  })(jQuery);

}).call(this);
